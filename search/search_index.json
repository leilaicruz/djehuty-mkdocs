{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to the Djehuty Documentation","text":"<p>Djehuty is the data repository system developed by and for 4TU.ResearchData. The name finds its inspiration in Thoth, the Egyptian entity that introduced the idea of writing.</p>"},{"location":"configuration/","title":"Configuration","text":""},{"location":"configuration/#chapter-2configuring-djehuty","title":"Chapter\u00a02Configuring djehuty","text":"<p>Now that djehuty is installed, it\u2019s a good moment to look into its run-time configuration options. All configuration can be done through a configuration file, for which an example is available at \u2018etc/djehuty/djehuty-example-config.xml\u2019.</p>"},{"location":"configuration/#21-essential-options","title":"2.1  Essential options","text":"<p>| Option | Description | | bind-address | The address to bind a TCP socket on. | | port | The port to bind a TCK socket on. | | base-url | The URL on which the instance will be available to the outside  world. | | allow-crawlers | Set to 1 to allow crawlers in the robots.txt, otherwise set to  0. | | production | Performs extra checks before starting. Enable this when  running a production instance. | | live-reload | When set to 1, it reloads Python code on-the-fly. We  recommend to set it to 0 when running in production. | | debug-mode | When set to 1, it will display backtraces and error messages in  the web browser. When set to 0, it will only show backtraces  and error messages in the web browser. | | use-x-forwarded-for | When running djehuty behind a reverse-proxy server, use the  HTTP header X-Forwarded-For to log IP address information. | | disable-collaboration | When set to 1, it disables the \u201ccollaborators\u201d feature. | | restrict-depositing-to-domain | By default, any authenticated user may deposit data. This  option limits the ability to deposit to users with an e-mail  address of a specific domain name. | | cache-root | djehuty can cache query responses to lower the load on the  database server. Specify the directory where to store cache files.  This element takes an attribute clear-on-start, and when  set to 1, it will remove all cache files on start-up of djehuty. | | profile-images-root | Users can upload a profile image in djehuty. This option  should point to a filesystem directory where these profile  images can be stored. | | disable-2fa | Accounts with privileges receive a code by e-mail as a second  factor when logging in. Setting this option to 1 disables the  second factor authentication. | | sandbox-message | Display a message on the top of every page. | | notice-message | Display a message on the main page. | | maintenance-mode | When set to 1, all HTTP requests result in the displayment of  a maintenance message. Use this option while backing up the  database, or when performing major updates. | |  |</p>"},{"location":"configuration/#22-configuring-the-database","title":"2.2  Configuring the Database","text":"<p>The djehuty program stores its state in a SPARQL 1.1 compliant RDF store. Configuring the connection details is done in the rdf-store node.</p> <p>| Option | Description | | state-graph | The graph name to store triplets in. | | sparql-uri | The URI at which the SPARQL 1.1 endpoint can be reached.When the sparql-uri begins with bdb://, followed by a  path to a filesystem directory, it will use the BerkeleyDB  back-end, for which the berkeleydb Python package needs to  be installed. | | sparql-update-uri | The URI at which the SPARQL 1.1 Update endpoint can be  reached (in case it is different from the sparql-uri. | |  |</p>"},{"location":"configuration/#23-audit-trails-and-database-reconstruction","title":"2.3  Audit trails and database reconstruction","text":"<p>The djehuty program can keep an audit log of all database modifications made by itself from which a database state can be reconstructed. Whether djehuty keeps such an audit log can be configured with the following option:</p> <p>| Option | Description | | enable-query-audit-log | When set to 1, it writes every SPARQL query that modifies  the database in the web logs. This can be replayed to  reconstruct the database at a later time. Setting this option  to 0 disables this feature. This element takes an attribute  transactions-directory that should specify an empty  directory to which transactions can be written that are  extracted from the audit log. | |  |</p>"},{"location":"configuration/#231-reconstructing-the-database-from-the-query-audit-log","title":"2.3.1  Reconstructing the database from the query audit log","text":"<p>Each query that modifies the database state while the query audit logs are enabled can be extracted from the query audit log using the --extract-transactions-from-log command-line option. A timestamp to specify the starting point to extract from can be specified as an argument. The following example displays its use:</p> <pre><code>djehuty web --config-file=config.xml --extract-transactions-from-log=\"YYYY-MM-DD HH:MM:SS\"\n</code></pre> <p>This will create a file for each query in the folder specified in the transactions-directory attribute.</p> <p>To replay the extracted transactions, use the apply-transactions command-line option: </p> <pre><code>djehuty web --config-file=config.xml --apply-transactions\n</code></pre> <p>When a query cannot be executed, the command stops, allowing to fix or remove the query to-be-replayed. Invoking the --apply-transactions command a second time will continue replaying where the previous run stopped.</p>"},{"location":"configuration/#24-configuring-storage","title":"2.4  Configuring storage","text":"<p>Storage locations can be configured with the storage node. When configuring multiple locations, djehuty attempts to find a file by looking at the first configured location, and in case it cannot find the file there, it will look at the second configured location, and so on, until it has tried each storage location. This allows for moving files between storage systems transparently without requiring specific interactions with djehuty other than having the files made available as a POSIX filesystem. One use-case that suits this mechanism is letting uploads write to fast online storage and later move the uploaded files to a slower but less costly storage.</p> <p>| Option | Description | | location | A filesystem path to where files are stored. This is a repeatable  property. | |  |</p>"},{"location":"configuration/#25-configuring-an-identity-provider","title":"2.5  Configuring an identity provider","text":"<p>Ideally, djehuty makes use of an external identity provider. djehuty can use SAML2.0, ORCID, or an internal identity provider (for testing and development purposes only). This section will outline the configuration options for each identity provision mechanism.</p>"},{"location":"configuration/#251-saml20","title":"2.5.1  SAML2.0","text":"<p>For SAML 2.0, the configuration can be placed in the saml section under authentication. That looks as following:</p> <pre><code>&lt;authentication&gt; \n  &lt;saml version=\"2.0\"&gt; \n    &lt;!-- Configuration goes here. --&gt; \n  &lt;/saml&gt; \n&lt;/authentication&gt;\n</code></pre> <p>The options outlined in the remainder of this section should be placed where the example shows \\&lt;!\u2013 Configuration goes here. \u2013&gt;.</p> <p>| Option | Description | | strict | When set to 1, SAML responses must be signed. Never disable \u2018strict\u2019 mode in a production environment. | | debug | Increases logging verbosity for SAML-related messages. | | attributes | In this section the attributes provided by the identity provider  can be aligned to the attributes djehuty expects. | | service-provider | The djehuty program fulfills the role of service provider. In  this section the certificate and service provider metadata can  be configured. | | identity-provider | In this section the certificate and single-sign-on URL of the  identity provider can be configured. | | sram | In this section, SURF Research Access Management-specific  attributes can be configured. | |  |</p>"},{"location":"configuration/#the-attributes-configuration","title":"The attributes configuration","text":"<p>To create account and author records and to authenticate a user, djehuty stores information provided by the identity provider. Each identity provider may provide this information using different attributes. Therefore, the translation from attributes used by djehuty and attributes given by the identity provider can be configured. The following attributes must be configured.</p> <p>| Option | Description | | first-name | A user\u2019s first name. | | last-name | A user\u2019s last name. | | common-name | A user\u2019s full name. | | email | A user\u2019s e-mail address. | | groups | The attribute denoting groups. | | group-prefix | The prefix for each group short name. | |  |</p> <p>As an example, the attributes configuration for SURFConext looks like this:</p> <pre><code>&lt;attributes&gt; \n  &lt;first-name&gt;urn:mace:dir:attribute-def:givenName&lt;/first-name&gt; \n  &lt;last-name&gt;urn:mace:dir:attribute-def:sn&lt;/last-name&gt; \n  &lt;common-name&gt;urn:mace:dir:attribute-def:cn&lt;/common-name&gt; \n  &lt;email&gt;urn:mace:dir:attribute-def:mail&lt;/email&gt; \n&lt;/attributes&gt;\n</code></pre> <p>And for SURF Research Access Management (SRAM), the attributes configuration looks like this:</p> <pre><code>&lt;attributes&gt; \n  &lt;first-name&gt;urn:oid:2.5.4.42&lt;/first-name&gt; \n  &lt;last-name&gt;urn:oid:2.5.4.4&lt;/last-name&gt; \n  &lt;common-name&gt;urn:oid:2.5.4.3&lt;/common-name&gt; \n  &lt;email&gt;urn:oid:0.9.2342.19200300.100.1.3&lt;/email&gt; \n  &lt;groups&gt;urn:oid:1.3.6.1.4.1.5923.1.1.1.7&lt;/groups&gt; \n  &lt;group-prefix&gt;urn:mace:surf.nl:sram:group:[organisation]:[service]&lt;/group-prefix&gt; \n&lt;/attributes&gt;\n</code></pre>"},{"location":"configuration/#the-sram-configuration","title":"The sram configuration","text":"<p>When using SURF Research Access Management (SRAM), djehuty can persuade SRAM to send an invitation to anyone inside or outside the institution to join the SRAM collaboration that provides access to the djehuty instance. To do so, the following attributes must be configured.</p> <p>| Option | Description | | organization-api-token | An organization-level API token. | | collaboration-id | The UUID of the collaboration to invite users to. | |  |</p>"},{"location":"configuration/#the-service-provider-configuration","title":"The service-provider configuration","text":"<p>| Option | Description | | x509-certificate | Contents of the public certificate without whitespacing. | | private-key | Contents  of the private key belonging to the x509-certificate to sign  messages with. | | metadata | This section contains metadata that may be displayed by the  identity provider to users before authorizing them. | | display-name | The name to be displayed by the identity provider when  authorizing the user to the service. | | url | The URL to the service. | | description | Textual description of the service. | | organization | This section contains metadata to describe the organization  behind the service. | | name | The name of the service provider\u2019s organization. | | url | The URL to the web page of the organization. | | contact | A repeatable section to list contact persons and their roles  within the organization. The role can be configured by setting  the type attribute. | | first-name | The first name of the contact person. | | last-name | The last name of the contact person. | | email | The e-mail address of the contact person. Note that some  identity providers prefer functional e-mail addresses (e.g.  support@... instead of jdoe@...). | |  |</p>"},{"location":"configuration/#252-orcid","title":"2.5.2  ORCID","text":"<p>ORCID.org plays a key role in making researchers findable. Its identity provider service can be used by djehuty in two ways:</p> <p>1. As primary identity provider to log in and deposit data;</p> <p>2. As additional identity provider to couple an author record to its ORCID record. When another identity provider is configured in addition to ORCID, that identity provider will be used as primary and ORCID will only be used to couple author records to the author\u2019s ORCID record. To configure ORCID, the configuration can be placed in the orcid section under authentication. That looks as following:</p> <pre><code>&lt;authentication&gt; \n  &lt;orcid&gt; \n    &lt;!-- Configuration goes here. --&gt; \n  &lt;/orcid&gt; \n&lt;/authentication&gt;\n</code></pre> <p>Then the following parameters can be configured:</p> <p>| Option | Description | | client-id | The client ID provided by ORCID. | | client-secret | The client secret provided by ORCID. | | endpoint | The URL to the ORCID endpoint to use. | |  |</p>"},{"location":"configuration/#26-configuring-an-e-mail-server","title":"2.6  Configuring an e-mail server","text":"<p>On various occassions, djehuty will attempt to send an e-mail to either an author, a reviewer or an administrator. To be able to do so, an e-mail server must be configured from which the instance may send e-mails. The configuration is done under the email node, and the following items can be configured:</p> <p>| Option | Description | | server | Address of the e-mail server without protocol specification. | | port | The port the e-mail server operates on. | | starttls | When 1, djehuty attempts to use StartTLS. | | username | The username to authenticate with to the e-mail server. | | password | The password to authenticate with to the e-mail server. | | from | The e-mail address used to send e-mail from. | | subject-prefix | Text to prefix in the subject of all e-mails sent from the  instance of djehuty. This can be used to distinguish a test  instance from a production instance. | |  |</p>"},{"location":"configuration/#27-configuring-doi-registration","title":"2.7  Configuring DOI registration","text":"<p>When publishing a dataset or collection, djehuty can register a persistent identifier with DataCite. To enable this feature, configure it under the datacite node. The following parameters can be configured:</p> <p>| Option | Description | | api-url | The URL of the API endpoint of DataCite. | | repository-id | The repository identifier given by DataCite. | | password | The password to authenticate with to DataCite. | | prefix | The DOI prefix to use when registering a DOI. | |  |</p>"},{"location":"configuration/#28-configuring-handle-registration","title":"2.8  Configuring Handle registration","text":"<p>Each uploaded file can be assigned a persistent identifier using the Handle system. To enable this feature, configure it under the handle node. The following parameters can be configured:</p> <p>| Option | Description | | url | The URL of the API endpoint of the Handle system  implementor. | | certificate | Certificate to use for authenticating to the endpoint. | | private-key | The private key paired with the certificate used to authenticate  to the endpoint. | | prefix | The Handle prefix to use when registering a handle. | | index | The index to use when registering a handle. | |  |</p>"},{"location":"configuration/#29-configuring-iiif-support","title":"2.9  Configuring IIIF support","text":"<p>When publishing images, djehuty can enable the IIIF Image API for the images. It uses libvips and pyvips under the hood to perform image manipulation. The following parameters can be configured:</p> <p>| Option | Description | | enable-iiif | Enable support for the IIIF image API. This requires the  pyvips package to be available in the run-time environment. | | iiif-cache-root | The directory to store the output of IIIF Image API requests  to avoid re-computing the image. | |  |</p>"},{"location":"configuration/#210-customizing-looks","title":"2.10  Customizing looks","text":"<p>With the following options, the instance can be branded as necessary.</p> <p>| Option | Description | | site-name | Name for the instance used in the title of a browser window  and as default value in the publisher field for new datasets. | | site-description | Description used as a meta-tag in the HTML output. | | site-shorttag | Used as keyword and as Git remote name. | | support-email-address | E-mail address used in e-mails sent to users in automated  messages. | | custom-logo-path | Path to a PNG image file that will be used as logo on the  website. | | custom-favicon-path | Path to an ICO file that will be used as favicon. | | small-footer | HTML that will be used as footer for all pages except for the  main page. | | large-footer | HTML that will be used as footer on the main page. | | show-portal-summary | When set to 1, it shows the repository summary of number of  datasets, authors, collections, files and bytes on the main page. | | show-institutions | When set to 1, it shows the list of institutions on the main  page. | | show-science-categories | When set to 1, it shows the subjects (categories) on the main  page. | | show-latest-datasets | When set to 1, it shows the list of latest published datasets on  the main page. | | colors | Colors used in the HTML output. See section 2.10.1. | |  |</p>"},{"location":"configuration/#2101-customizing-colors","title":"2.10.1  Customizing colors","text":"<p>The following options can be configured in the colors section.</p> <p>| Option | Description | | primary-color | The main background color to use. | | primary-foreground-color | The main foreground color to use. | | primary-color-hover | Color to use when hovering a link. | | primary-color-active | Color to use when a link is clicked. | | privilege-button-color | The background color of buttons for privileged actions. | | footer-background-color | Color to use in the footer. | |  |</p>"},{"location":"configuration/#211-configuring-privileged-users","title":"2.11  Configuring privileged users","text":"<p>By default an authenticated user may deposit data. But users can have additional roles; for example: a dataset reviewer, a technical administrator or a quota reviewer. Such additional roles are configured in terms of privileges. The following privileges can be configured in the privileges section:</p> <p>| Option | Description | | may-administer | Allows access to perform maintenance tasks, view accounts and  view reports on restricted and embargoed datasets. | | may-run-sparql-queries | Allows to run arbitrary SPARQL queries on the database. | | may-impersonate | Allows to log in to any account and therefore perform any  action as that account. | | may-review | Allows to see which datasets are sent for review, and allows to  perform reviews. | | may-review-quotas | Allows access to see requests for storage quota increases and  approve or decline them. | | may-review-integrity | Allows access to an API call that provides statistics on the  accessibility of files on the filesystem. | | may-process-feedback | Accounts with this privilege will receive e-mails with the  information entered into the feedback form by other users. | | may-receive-email-notifications | This \u201cprivilege\u201d can be used to disable sending any e-mails to  an account by setting it to 0. The default is 1. | |  |</p> <p>To enable a privilege for an account, set the value of the desired privilege to 1. Privileges are disabled by default, except for may-receive-email-notifications which defaults to 1.</p> <pre><code>  &lt;privileges&gt; \n    &lt;account email=\"you@example.com\" orcid=\"0000-0000-0000-0001\"&gt; \n      &lt;may-administer&gt;1&lt;/may-administer&gt; \n      &lt;may-run-sparql-queries&gt;1&lt;/may-run-sparql-queries&gt; \n      &lt;may-impersonate&gt;1&lt;/may-impersonate&gt; \n      &lt;may-review&gt;0&lt;/may-review&gt; \n      &lt;may-review-quotas&gt;0&lt;/may-review-quotas&gt; \n      &lt;may-review-integrity&gt;0&lt;/may-review-integrity&gt; \n      &lt;may-process-feedback&gt;0&lt;/may-process-feedback&gt; \n      &lt;may-receive-email-notifications&gt;1&lt;/may-receive-email-notifications&gt; \n    &lt;/account&gt; \n  &lt;/privileges&gt;\n</code></pre>"},{"location":"intro/","title":"Introduction","text":""},{"location":"intro/#chapter-1introduction","title":"Chapter\u00a01Introduction","text":"<p>djehuty is the data repository system developed by and for 4TU.ResearchData. The name finds its inspiration in Thoth, the Egyptian entity that introduced the idea of writing.</p>"},{"location":"intro/#11-obtaining-the-source-code","title":"1.1  Obtaining the source code","text":"<p>The source code can be downloaded at the Releases1  page. Make sure to download the djehuty-24.10.1.tar.gz file. Or, directly download the tarball using the command-line:</p> <pre><code>curl -LO https://github.com/4TUResearchData/djehuty/releases/\\  \ndownload/v24.10.1/djehuty-24.10.1.tar.gz\n</code></pre> <p>After obtaining the tarball, it can be unpacked using the tar command:</p> <pre><code>tar zxvf djehuty-24.10.1.tar.gz\n</code></pre>"},{"location":"intro/#12-installing-the-prerequisites","title":"1.2  Installing the prerequisites","text":"<p>The djehuty program needs Python (version 3.8 or higher) and Git to be installed. Additionally, a couple of Python packages need to be installed. The following sections describe installing the prerequisites on various GNU/Linux distributions. To put the software in the context of its environment, figure 1.1 displays the complete run-time dependencies from djehuty to glibc.</p> <p></p> <p>Figure\u00a01.1: Run-time references when constructed with the packages from GNU Guix. \u00a0\u00a0</p> <p>The web service of djehuty stores its information in a SPARQL 1.1 (\u201cSPARQL 1.1 Overview\u201d,\u00a02013) endpoint. We recommend either Blazegraph2 or Virtuoso open-source edition3 .</p>"},{"location":"intro/#121-installation-on-enterprise-linux-7","title":"1.2.1  Installation on Enterprise Linux 7+","text":"<p>The Python packages on Enterprise Linux version 7 or higher seem to be too far out of date. So installing the prerequisites involves two steps. The first step involves installing system-wide packages for Python and Git.</p> <pre><code>yum install python39 git\n</code></pre> <p>The second step involves using Python\u2019s venv module to install the Python packages in a virtual environment:</p> <pre><code>python3.9 -m venv djehuty-env \n. djehuty-env/bin/activate \ncd /path/to/the/repository/checkout/root \npip install -r requirements.txt\n</code></pre>"},{"location":"intro/#13-installation-instructions","title":"1.3  Installation instructions","text":"<p>After obtaining the source code (see section 1.1 \u2018Obtaining the source code\u2019) and installing the required tools (see section 1.2 \u2018Installing the prerequisites\u2019), building involves running the following commands:</p> <pre><code>cd djehuty-24.10.1 \nautoreconf -vif # Only needed if the \"./configure\" step does not work. \n./configure \nmake \nmake install\n</code></pre> <p>To run the make install command, super user privileges may be required. Specify a --prefix to the configure script to install the tools to a user-writeable location to avoid needing super user privileges. After installation, the djehuty program will be available.</p>"},{"location":"intro/#14-pre-built-containers","title":"1.4  Pre-built containers","text":"<p>4TU.ResearchData provides Docker container images as a convenience service for each monthly djehuty release. The following table outlines the meaning of each image provided. The images are published to Docker Hub4 .</p> <p>| Image tag | Description | | devel | Image meant for development purposes. Before it executes the djehuty  command it checks out the latest codebase. So re-running the same  container image may result in running a different version of djehuty. | | latest | This image points to the latest djehuty release. It does not automatically  update the djehuty codebase. | | XX.X | 4TU.ResearchData releases a version each month where the number before  the dot refers to the year and the number after the dot refers to the month.  Use a specific version image when you want to upgrade at your own pace. | |  |</p> <p>To build the container images for yourself, see the build instructions in the \u2018docker/Dockerfile\u2019 file.</p>"}]}